<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kör Test Analiz Paneli</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        doc: { light: '#f1f5f9', DEFAULT: '#64748b', dark: '#334155' }, // Gri (Doktor)
                        modelA: { light: '#e0e7ff', DEFAULT: '#6366f1', dark: '#4338ca' }, // Indigo (Gemini)
                        modelB: { light: '#d1fae5', DEFAULT: '#10b981', dark: '#047857' }, // Emerald (ChatGPT)
                        modelC: { light: '#ffedd5', DEFAULT: '#f97316', dark: '#c2410c' }, // Orange (Claude)
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; color: #334155; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .glass-panel { background: white; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Markdown Benzeri Formatlama */
        .md-header-1 { font-size: 1.2rem; font-weight: 800; color: #0f172a; margin: 1rem 0 0.5rem 0; border-bottom: 2px solid #e2e8f0; }
        .md-header-2 { font-size: 1.1rem; font-weight: 700; color: #1e293b; margin: 0.8rem 0 0.4rem 0; background-color: #f8fafc; padding: 2px 8px; border-left: 4px solid #cbd5e1; }
        .md-bold { font-weight: 700; color: #0f172a; background-color: #fff1f2; padding: 0 2px; }
        
        /* Skor Rozetleri */
        .badge { display: inline-flex; align-items: center; px-2; py-0.5; border-radius: 4px; font-size: 0.7rem; font-weight: 700; }
        .score-high { color: #15803d; background: #dcfce7; border: 1px solid #86efac; } /* 90-100 */
        .score-med { color: #854d0e; background: #fef9c3; border: 1px solid #fde047; } /* 70-90 */
        .score-low { color: #991b1b; background: #fee2e2; border: 1px solid #fca5a5; } /* 0-70 */
        
        /* Tab Butonları */
        .tab-btn { position: relative; transition: all 0.2s; }
        .tab-btn.active { background-color: white; border-bottom: 2px solid currentColor; font-weight: 600; }
        .tab-btn.active-modelA { color: #4338ca; border-color: #6366f1; }
        .tab-btn.active-modelB { color: #047857; border-color: #10b981; }
        .tab-btn.active-modelC { color: #c2410c; border-color: #f97316; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">A</div>
                <div>
                    <h1 class="font-bold text-slate-800 leading-tight">Okunabilirlik Analizi</h1>
                    <p class="text-xs text-slate-500">Ateşman Formülü • Kör Test Modu</p>
                </div>
            </div>
            <label class="cursor-pointer bg-slate-900 hover:bg-slate-800 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                <span>Excel Yükle</span>
                <input type="file" id="fileInput" accept=".xlsx, .csv" class="hidden">
            </label>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 py-8">
        
        <div id="loadingState" class="flex flex-col items-center justify-center py-20 bg-white rounded-2xl border-2 border-dashed border-slate-200 text-center">
            <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
            </div>
            <h3 class="text-lg font-semibold text-slate-900">Dosya Bekleniyor</h3>
            <p class="text-slate-500 text-sm mt-1">Lütfen 'raporlama_atesman_tum_skorlar.xlsx' dosyasını yükleyin.</p>
        </div>

        <div id="dashboardContent" class="hidden space-y-8">
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="glass-panel p-4 rounded-xl border-l-4 border-slate-500">
                    <p class="text-xs font-bold text-slate-400 uppercase">REFERANS (DOKTOR)</p>
                    <div class="flex items-end gap-2 mt-1">
                        <span class="text-2xl font-bold text-slate-700" id="statDoc">0.0</span>
                        <span class="text-xs text-slate-400 mb-1">Ort. Skor</span>
                    </div>
                </div>
                <div class="glass-panel p-4 rounded-xl border-l-4 border-modelA-DEFAULT">
                    <p class="text-xs font-bold text-indigo-400 uppercase">MODEL A</p>
                    <div class="flex items-end gap-2 mt-1">
                        <span class="text-2xl font-bold text-indigo-700" id="statA">0.0</span>
                        <span class="text-xs text-indigo-300 mb-1">Ort. Skor</span>
                    </div>
                </div>
                <div class="glass-panel p-4 rounded-xl border-l-4 border-modelB-DEFAULT">
                    <p class="text-xs font-bold text-emerald-400 uppercase">MODEL B</p>
                    <div class="flex items-end gap-2 mt-1">
                        <span class="text-2xl font-bold text-emerald-700" id="statB">0.0</span>
                        <span class="text-xs text-emerald-300 mb-1">Ort. Skor</span>
                    </div>
                </div>
                <div class="glass-panel p-4 rounded-xl border-l-4 border-modelC-DEFAULT">
                    <p class="text-xs font-bold text-orange-400 uppercase">MODEL C</p>
                    <div class="flex items-end gap-2 mt-1">
                        <span class="text-2xl font-bold text-orange-700" id="statC">0.0</span>
                        <span class="text-xs text-orange-300 mb-1">Ort. Skor</span>
                    </div>
                </div>
            </div>

            <div class="glass-panel rounded-xl p-6">
                <h3 class="text-sm font-bold text-slate-700 mb-4">Performans Karşılaştırması</h3>
                <div class="h-64 w-full">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex flex-col sm:flex-row justify-between gap-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        Detaylı Rapor İncelemesi
                        <span id="countBadge" class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded-full">0</span>
                    </h2>
                    <input type="text" id="searchInput" placeholder="Metin içinde ara..." class="border border-slate-200 rounded-lg px-4 py-2 text-sm w-full sm:w-64 focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>

                <div id="reportList" class="space-y-8">
                    </div>
            </div>
        </div>
    </main>

    <script>
        // --- AYARLAR ---
        // Excel kolon başlıklarını tam olarak buraya yazıyoruz.
        // Model A = Gemini, Model B = ChatGPT, Model C = Claude
        const CONFIG = {
            Doc: { colText: 'Gerçek', colScore: 'Gerçek_Atesman_Skoru', label: 'Doktor Raporu', color: '#64748b' },
            A: { colText: 'Gemini', colScore: 'Gemini_Atesman_Skoru', label: 'Model A', color: '#6366f1' },
            B: { colText: 'Chatgpt', colScore: 'Chatgpt_Atesman_Skoru', label: 'Model B', color: '#10b981' },
            C: { colText: 'Claud', colScore: 'Claud_Atesman_Skoru', label: 'Model C', color: '#f97316' }
        };

        let DATA = [];
        let CHART_INSTANCE = null;

        document.getElementById('fileInput').addEventListener('change', handleFile);
        document.getElementById('searchInput').addEventListener('input', renderList);

        function handleFile(e) {
            const file = e.target.files[0];
            if(!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet);

                processData(json);
            };
            reader.readAsArrayBuffer(file);
        }

        function processData(json) {
            // Veriyi normalize et
            DATA = json.map((row, index) => {
                return {
                    id: index + 1,
                    doc: { text: row[CONFIG.Doc.colText], score: row[CONFIG.Doc.colScore] },
                    modelA: { text: row[CONFIG.A.colText], score: row[CONFIG.A.colScore] },
                    modelB: { text: row[CONFIG.B.colText], score: row[CONFIG.B.colScore] },
                    modelC: { text: row[CONFIG.C.colText], score: row[CONFIG.C.colScore] }
                };
            }).filter(item => item.doc.text); // Boş satırları temizle

            initDashboard();
        }

        function initDashboard() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');

            updateStats();
            renderChart();
            renderList();
        }

        function updateStats() {
            const getAvg = (key) => {
                const vals = DATA.map(d => d[key].score).filter(s => s != null);
                return vals.length ? (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(1) : '-';
            };

            document.getElementById('statDoc').innerText = getAvg('doc');
            document.getElementById('statA').innerText = getAvg('modelA');
            document.getElementById('statB').innerText = getAvg('modelB');
            document.getElementById('statC').innerText = getAvg('modelC');
        }

        function renderChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const labels = DATA.slice(0, 20).map(d => '#' + d.id); // İlk 20 rapor
            
            if(CHART_INSTANCE) CHART_INSTANCE.destroy();

            CHART_INSTANCE = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Doktor', data: DATA.slice(0,20).map(d=>d.doc.score), borderColor: CONFIG.Doc.color, borderWidth: 2, pointRadius: 0, borderDash: [5,5] },
                        { label: 'Model A', data: DATA.slice(0,20).map(d=>d.modelA.score), borderColor: CONFIG.A.color, backgroundColor: CONFIG.A.color, tension: 0.3 },
                        { label: 'Model B', data: DATA.slice(0,20).map(d=>d.modelB.score), borderColor: CONFIG.B.color, backgroundColor: CONFIG.B.color, tension: 0.3 },
                        { label: 'Model C', data: DATA.slice(0,20).map(d=>d.modelC.score), borderColor: CONFIG.C.color, backgroundColor: CONFIG.C.color, tension: 0.3 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { position: 'top' },
                        tooltip: { callbacks: { label: function(c){ return c.dataset.label + ': ' + c.raw.toFixed(1); } } }
                    },
                    scales: {
                        y: { beginAtZero: false, min: 40, max: 110, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function renderList() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('reportList');
            container.innerHTML = '';

            const filtered = DATA.filter(item => 
                (item.doc.text + item.modelA.text + item.modelB.text + item.modelC.text).toLowerCase().includes(query)
            );

            document.getElementById('countBadge').innerText = filtered.length;

            // Performans için sadece ilk 50 sonucu göster
            filtered.slice(0, 200).forEach(item => {
                const card = document.createElement('div');
                card.className = 'glass-panel rounded-xl overflow-hidden';
                
                // HTML Yapısı
                card.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-12 min-h-[400px]">
                        <div class="lg:col-span-4 bg-slate-50 p-6 border-b lg:border-b-0 lg:border-r border-slate-200 flex flex-col">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <span class="bg-slate-800 text-white text-xs font-bold px-2 py-1 rounded">Rapor #${item.id}</span>
                                    <h4 class="text-sm font-bold text-slate-700 mt-1">Orijinal Rapor</h4>
                                </div>
                                ${getScoreBadge(item.doc.score)}
                            </div>
                            <div class="text-xs text-slate-600 font-mono whitespace-pre-wrap overflow-y-auto custom-scrollbar flex-grow pr-2">${item.doc.text || 'Metin yok'}</div>
                        </div>

                        <div class="lg:col-span-8 bg-white flex flex-col">
                            <div class="flex border-b border-slate-100">
                                <button onclick="switchTab(${item.id}, 'A')" class="tab-btn active active-modelA flex-1 py-3 text-sm flex items-center justify-center gap-2" id="btn-${item.id}-A">
                                    Model A ${getScoreBadge(item.modelA.score)}
                                </button>
                                <button onclick="switchTab(${item.id}, 'B')" class="tab-btn flex-1 py-3 text-sm flex items-center justify-center gap-2" id="btn-${item.id}-B">
                                    Model B ${getScoreBadge(item.modelB.score)}
                                </button>
                                <button onclick="switchTab(${item.id}, 'C')" class="tab-btn flex-1 py-3 text-sm flex items-center justify-center gap-2" id="btn-${item.id}-C">
                                    Model C ${getScoreBadge(item.modelC.score)}
                                </button>
                            </div>

                            <div class="p-6 relative flex-grow overflow-y-auto max-h-[500px]">
                                <div id="content-${item.id}-A" class="model-content animate-fade-in text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">${formatMD(item.modelA.text)}</div>
                                <div id="content-${item.id}-B" class="model-content hidden text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">${formatMD(item.modelB.text)}</div>
                                <div id="content-${item.id}-C" class="model-content hidden text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">${formatMD(item.modelC.text)}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- YARDIMCILAR ---
        
        window.switchTab = function(id, model) {
            // Butonları resetle
            ['A', 'B', 'C'].forEach(m => {
                const btn = document.getElementById(`btn-${id}-${m}`);
                const content = document.getElementById(`content-${id}-${m}`);
                
                btn.classList.remove('active', 'active-modelA', 'active-modelB', 'active-modelC');
                content.classList.add('hidden');
                
                // Hover class ekle (opsiyonel)
                btn.classList.add('text-slate-500');
            });

            // Seçileni aktif et
            const activeBtn = document.getElementById(`btn-${id}-${model}`);
            const activeContent = document.getElementById(`content-${id}-${model}`);
            
            activeBtn.classList.remove('text-slate-500');
            activeBtn.classList.add('active', `active-model${model}`);
            activeContent.classList.remove('hidden');
        }

        function getScoreBadge(score) {
            if(!score) return '<span class="text-xs text-slate-300">N/A</span>';
            let cls = 'score-low'; // Zor
            if(score >= 90) cls = 'score-high'; // Çok Kolay
            else if(score >= 70) cls = 'score-med'; // Orta
            
            return `<span class="badge ${cls}">${score.toFixed(1)}</span>`;
        }

        function formatMD(text) {
            if(!text) return '<span class="italic text-slate-300">Veri yok</span>';
            // Basit Markdown Dönüştürücü
            return text
                .replace(/^# (.*$)/gm, '<h1 class="md-header-1">$1</h1>')
                .replace(/^## (.*$)/gm, '<h2 class="md-header-2">$1</h2>')
                .replace(/^### (.*$)/gm, '<h3 class="font-bold mt-2 text-slate-800">$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<span class="md-bold">$1</span>')
                .replace(/\*(.*?)\*/g, '<span class="italic text-slate-600">$1</span>')
                .replace(/^- (.*$)/gm, '<li class="ml-4 list-disc">$1</li>');
        }
    </script>
</body>
</html>